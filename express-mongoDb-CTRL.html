<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MongoDB - CTRL</title>
    <link rel="stylesheet" href="./css/main.min.css" />
  </head>
  <body style="background-color: rgb(230, 230, 230)">
    <div class="wrapper">
      <header>
        <div class="container">
          <span><a href="./index.html">Home</a></span>

          <a
            class="github-link"
            target="_blank"
            href="https://github.com/torkotiuk/dev"
          >
            <svg width="20" height="20">
              <use href="./assets/images/sprite.svg#icon-github"></use>
            </svg>
          </a>
        </div>
      </header>

      <main class="main">
        <section class="section">
          <div class="container">
            <nav
              style="
                display: flex;
                flex-wrap: wrap;
                justify-content: space-around;
              "
            >
              <a href="./express-mongoDb.html">Express.js + MongoDB</a>
              <span class="current">Express + MongoDB controllers</span>
              <a href="./express-mongoDB-schema.html">MongoDB Schema</a>
            </nav>

            <h1>Express + MongoDB controllers</h1>

            <ol>
              <li
                style="
                  background-color: rgb(251, 255, 220);
                  border-radius: 8px;
                  margin-bottom: 10px;
                "
              >
                Make the
                <a
                  target="_blank"
                  href="./express-mongoDB-schema._simplest.html"
                  ><b>simplest Schema</b></a
                >
                in models/schemas/product.schema.js for quick start with MongoDb
                (or go to
                <a href="./express-mongoDB-schema.html">MongoDb Schema</a>
                for making a usual projects one).
              </li>
              <!-- POST -->
              <li
                style="
                  background-color: rgb(251, 255, 220);
                  border-radius: 8px;
                  margin-bottom: 10px;
                "
              >
                <b style="background-color: #009d77; color: #fff; padding: 5px"
                  >POST</b
                >

                <h4 style="color: green; margin-top: 20px; text-align: center">
                  Controller POST works with MongoDB
                </h4>
                <ul>
                  <li>
                    Refactor ctrl from local file to work with MongoDB or create
                    controllers/products/addProductCTRL.js (remember about
                    reexports in controllers\products\index.js)
                    <p
                      class="codepen"
                      data-height="440"
                      data-default-tab="js"
                      data-slug-hash="NWLVeWe"
                      data-user="imitator"
                      style="
                        height: 300px;
                        box-sizing: border-box;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        border: 2px solid;
                        margin: 1em 0;
                        padding: 1em;
                      "
                    >
                      <span
                        >See the Pen
                        <a href="https://codepen.io/imitator/pen/NWLVeWe">
                          18 - POST ctrl using for MongoDB</a
                        >
                        by Andrii (<a href="https://codepen.io/imitator"
                          >@imitator</a
                        >) on <a href="https://codepen.io">CodePen</a>.</span
                      >
                    </p>
                    <script
                      async
                      src="https://cpwebassets.codepen.io/assets/embed/ei.js"
                    ></script>
                    <p>
                      Some errors aren't in list of
                      <a
                        target="_blank"
                        href="https://umbraco.com/knowledge-base/http-status-codes/"
                        >http-status-codes</a
                      >, so we try to handle them in catch(error){}, other
                      errors we gather in other place by sending them in
                      <b>next(error)</b>, in app.js(index.js), this will be
                      explaining in next
                      <a target="_blank" href="./express-catchErrors.html"
                        >Catching errors middleware guide</a
                      >
                    </p>
                  </li>
                  <li>
                    Add Catching errors middleware to server.js (or index.js)
                    after all middlewares.
                  </li>

                  <li>
                    Create in routes/products.routes.js the route:
                    <b>router.post('/', ctrl.addProductCTRL);</b>
                  </li>
                  <li>
                    Make some post request (<a
                      target="_blank"
                      href="./postman-request.html"
                      >via POSTMAN f.e.</a
                    >)
                  </li>
                </ul>
              </li>
              <!-- getAll -->
              <li
                style="
                  background-color: white;
                  border-radius: 8px;
                  margin-bottom: 10px;
                "
              >
                <b style="background-color: #1391ff; padding: 5px; color: #fff">
                  getAll</b
                >
                Refactor controllers\products\getAllProductsCTRL.js for work
                with MongoDb.
                <p>
                  P.S. Mongoose method Model.find({}) - empty obj {} means to
                  find all documents
                </p>
                <!--  -->
                <ul>
                  <li>
                    <p
                      class="codepen"
                      data-height="360"
                      data-default-tab="js"
                      data-slug-hash="JjmyVMp"
                      data-user="imitator"
                      style="
                        height: 300px;
                        box-sizing: border-box;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        border: 2px solid;
                        margin: 1em 0;
                        padding: 1em;
                      "
                    >
                      <span
                        >See the Pen
                        <a href="https://codepen.io/imitator/pen/JjmyVMp">
                          21 - getAll ___ctrl__ MongoDB</a
                        >
                        by Andrii (<a href="https://codepen.io/imitator"
                          >@imitator</a
                        >) on <a href="https://codepen.io">CodePen</a>.</span
                      >
                    </p>
                    <script
                      async
                      src="https://cpwebassets.codepen.io/assets/embed/ei.js"
                    ></script>
                  </li>
                  <li>
                    Make a get request in postman for address
                    <a
                      target="_blank"
                      href="http://localhost:5555/api/v1/products"
                      >http://localhost:5555/api/v1/products</a
                    >
                    or check it in a browser
                  </li>
                  <li>
                    This point is more for explanation & useful for frontend
                    developers. In case when a collection doesn't have any items
                    the controller above ‚òùüèº response like "[]", so for
                    additional information for frontend developers we add
                    <a
                      target="_blank"
                      href="https://codepen.io/imitator/pen/PoyEgbE?editors=0010"
                      >one more checking in code</a
                    >
                  </li>
                  <li>
                    This point is needed if we connect products collection with
                    categories collection.
                    <a
                      target="_blank"
                      href="https://codepen.io/imitator/pen/OJBERyy?editors=0010"
                      >Controller with populate() method.</a
                    >
                  </li>
                </ul>
                <!--  -->
              </li>
              <!-- getById -->
              <li
                style="
                  background-color: white;
                  border-radius: 8px;
                  margin-bottom: 10px;
                "
              >
                <b style="background-color: #1391ff; padding: 5px; color: #fff">
                  getById</b
                >
                <ul>
                  <li>
                    Make controllers\products\getByIdProductCTRL.js (remember
                    about reexport in controllers\products\index.js)
                    <p
                      class="codepen"
                      data-height="460"
                      data-default-tab="js"
                      data-slug-hash="gOBxyvJ"
                      data-user="imitator"
                      style="
                        height: 300px;
                        box-sizing: border-box;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        border: 2px solid;
                        margin: 1em 0;
                        padding: 1em;
                      "
                    >
                      <span
                        >See the Pen
                        <a href="https://codepen.io/imitator/pen/gOBxyvJ">
                          22 - getById __ctrl__MondoDb</a
                        >
                        by Andrii (<a href="https://codepen.io/imitator"
                          >@imitator</a
                        >) on <a href="https://codepen.io">CodePen</a>.</span
                      >
                    </p>
                    <script
                      async
                      src="https://cpwebassets.codepen.io/assets/embed/ei.js"
                    ></script>
                  </li>
                  <li>
                    Create in routes/products.routes.js the route:
                    router.get('/:id', ctrl.getById);
                  </li>
                  <li>
                    Make a get request in postman for address:
                    <span
                      >http://localhost:5555/api/v1/products/<span
                        style="color: green"
                        >IDfromDataBase</span
                      >
                    </span>
                  </li>
                  <li>
                    P.S. remember about other methods for finding item, like
                    <div>Product.findOne({ _id: id });</div>
                    <div>Product.findOne({ email });</div>
                  </li>
                </ul>
              </li>
              <!-- UPDATE -->
              <li
                style="
                  background-color: rgb(235, 240, 255);
                  border-radius: 8px;
                  margin-bottom: 10px;
                "
              >
                <b style="background-color: #e97500; color: #fff; padding: 5px"
                  >UPDATE</b
                >
                <ul>
                  <li>
                    Make controllers\products\updateProductCTRL.js (remember
                    about reexport in controllers\products\index.js)
                  </li>
                  <li>
                    <p
                      class="codepen"
                      data-height="500"
                      data-default-tab="js"
                      data-slug-hash="YzJxMaR"
                      data-user="imitator"
                      style="
                        height: 300px;
                        box-sizing: border-box;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        border: 2px solid;
                        margin: 1em 0;
                        padding: 1em;
                      "
                    >
                      <span
                        >See the Pen
                        <a href="https://codepen.io/imitator/pen/YzJxMaR">
                          23 - update __ctrl__MongoDb</a
                        >
                        by Andrii (<a href="https://codepen.io/imitator"
                          >@imitator</a
                        >) on <a href="https://codepen.io">CodePen</a>.</span
                      >
                    </p>
                    <script
                      async
                      src="https://cpwebassets.codepen.io/assets/embed/ei.js"
                    ></script>
                  </li>
                  <li>
                    Create in routes/products.routes.js the route:
                    router.put('/:id', ctrl.updateProductCTRL);
                  </li>
                  <li>
                    Make a put request in postman for address:
                    <span
                      >http://localhost:5555/api/v1/products/<span
                        style="color: green"
                        >IDfromDataBase</span
                      >
                    </span>
                  </li>
                  <li>
                    P.S. method findIdAndUpdate works like http method
                    <b style="color: #61affe">PATCH</b>, that means that we may
                    sent only one field with change, not all object.
                  </li>
                </ul>
              </li>
              <li
                style="
                  background-color: white;
                  border-radius: 8px;
                  margin-bottom: 10px;
                "
              >
                <b style="background-color: #61affe; color: #fff; p5">PATCH</b>
                <ul>
                  <li>
                    In example before (in http method UPDATE) found out that we
                    may use the same route for patching data.
                  </li>
                </ul>
              </li>
              <!-- DELETE -->
              <li
                style="
                  background-color: white;
                  border-radius: 8px;
                  margin-bottom: 10px;
                "
              >
                <b style="background-color: #cf3030; color: #fff; p5">DELETE</b>
                <p>
                  P.S. It is impossible to create "delete" controller name, b/c
                  it is reserved word.
                </p>

                <ul>
                  <li>
                    Make controllers\products\delProductCTRL.js (remember about
                    reexport in controllers\products\index.js)
                  </li>
                  <li>
                    <p
                      class="codepen"
                      data-height="500"
                      data-default-tab="js"
                      data-slug-hash="rNqzbvw"
                      data-user="imitator"
                      style="
                        height: 300px;
                        box-sizing: border-box;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        border: 2px solid;
                        margin: 1em 0;
                        padding: 1em;
                      "
                    >
                      <span
                        >See the Pen
                        <a href="https://codepen.io/imitator/pen/rNqzbvw">
                          24 - delete __ctrl__MongoDb</a
                        >
                        by Andrii (<a href="https://codepen.io/imitator"
                          >@imitator</a
                        >) on <a href="https://codepen.io">CodePen</a>.</span
                      >
                    </p>
                    <script
                      async
                      src="https://cpwebassets.codepen.io/assets/embed/ei.js"
                    ></script>
                  </li>
                  <li>
                    Create in routes/products.routes.js the route:
                    router.delete('/:id', ctrl.delProductCTRL);
                  </li>
                  <li>
                    Make a delete request in postman for address:
                    <span
                      >http://localhost:5555/api/v1/products/<span
                        style="color: green"
                        >IDfromDataBase</span
                      >
                    </span>
                  </li>
                  <li>
                    <p>
                      P.S. getById, update & delete controllers look for object
                      by id, so if id isn't found in db, mongoDb response error
                      like
                      <span style="color: red"
                        >"Cast to ObjectId failed for..."</span
                      >
                      and according to our
                      <a target="_blank" href="./express-catchErrors.html"
                        >Catching errors middleware</a
                      >
                      response code=500, but it isn't really "server error",
                      more "Bad request" with code=400, also frontend developers
                      will understand better error message `Product with id ---
                      ${req.params.id} --- Not Found`. So this kind of error
                      should be caught by commented code in catch(error) {}
                    </p>
                  </li>
                </ul>
              </li>
              <li
                style="
                  background-color: rgb(235, 240, 255);
                  border-radius: 8px;
                  margin-bottom: 10px;
                "
              >
                <p>
                  Next step of creating a convenient web-server project (but not
                  necessarily, if you do it first time, you should missed this
                  point) is separating transferring information from controllers
                  (means like Model.create(), Model.find()) to separate folder,
                  called
                  <b>services</b> in root of a project. So in this case
                  <a
                    target="_blank"
                    href="./express-mongoDb-CTRL__services.html"
                    >controllers with services</a
                  >
                  will be look like.
                </p>
              </li>
            </ol>

            <div>
              P.S.
              <div>
                There are methods in mongoose, that response us not really
                necessary info: updateOne, deleteOne, updateMany, deleteMany
                <div>return Category.updateOne({ _id: id }, body);</div>
                <p>-</p>
                <div>return Category.findByIdAndUpdate(id, body);</div>
                <div>findByIdAndUpdate - response old object</div>
                <p>-</p>
                <div>return Category.findOneAndUpdate({ _id: id }, body);</div>
                <div>findOneAndUpdate - response old object</div>
                <p>-</p>

                <p>Setting <b>{ new: true }</b> helps response updated obj</p>
                <div>
                  return Category.findOneAndUpdate({ _id: id }, body, { new:
                  true });
                </div>
                <div>
                  return Category.findByIdAndUpdate(id, body, { new: true });
                </div>
                <p>
                  Also findByIdAndUpdate updates in object only field, that we
                  would like to update
                </p>

                <div>
                  F.e. obj in db {name: "abc", price: 555}, in request we may
                  write only {price: 123}
                </div>
                <div>
                  To sum up mongoose method findIdAndUpdate works like http
                  method <b style="color: #61affe">PATCH</b>
                </div>
              </div>
            </div>
          </div>
        </section>
      </main>

      <footer><div class="container">Footer</div></footer>
    </div>
  </body>
</html>
